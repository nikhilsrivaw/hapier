 generator client {
    provider = "prisma-client-js"
  }

  datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
  }

  // Multi-tenant: Each organization is a separate company
  model Organization {
    id        String   @id @default(cuid())
    name      String
    slug      String   @unique
    logo      String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    users       User[]
    employees   Employee[]
    departments Department[]
    leaveTypes  LeaveType[]
    tasks       Task[]  
    projects Project[]
  }

  // Authentication & access control
  model User {
    id             String   @id @default(cuid())
    email          String   @unique
    passwordHash   String
    role           Role     @default(EMPLOYEE)
    isActive       Boolean  @default(true)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    employee Employee?
  }

  enum Role {
    SUPER_ADMIN
    ADMIN
    HR_MANAGER
    MANAGER
    EMPLOYEE
  }

  model Department {
    id        String   @id @default(cuid())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    employees Employee[]
  }

  model Employee {
    id            String    @id @default(cuid())
    employeeCode  String
    firstName     String
    lastName      String
    email         String
    phone         String?
    dateOfBirth   DateTime?
    gender        Gender?
    address       String?
    joiningDate   DateTime
    designation   String
    salary        Decimal   @db.Decimal(12, 2)
    status        EmployeeStatus @default(ACTIVE)
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    departmentId String
    department   Department @relation(fields: [departmentId], references: [id])

    userId String? @unique
    user   User?   @relation(fields: [userId], references: [id])

    managerId String?
    manager   Employee?  @relation("ManagerReports", fields: [managerId], references: [id])
    reports   Employee[] @relation("ManagerReports")

    attendances   Attendance[]
    leaveRequests LeaveRequest[]
    assignedTasks Task[] @relation("TaskAssignee")
    createdTasks  Task[] @relation("TaskCreator")
    ownedProjects Project[] @relation("ProjectOwner")
  }

  enum Gender {
    MALE
    FEMALE
    OTHER
  }

  enum EmployeeStatus {
    ACTIVE
    ON_NOTICE
    TERMINATED
    ON_LEAVE
  }

  model Attendance {
    id        String    @id @default(cuid())
    date      DateTime  @db.Date
    checkIn   DateTime?
    checkOut  DateTime?
    status    AttendanceStatus @default(PRESENT)
    notes     String?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    employeeId String
    employee   Employee @relation(fields: [employeeId], references: [id])

    @@unique([employeeId, date])
  }

  enum AttendanceStatus {
    PRESENT
    ABSENT
    HALF_DAY
    LATE
    ON_LEAVE
  }

  model LeaveType {
    id             String  @id @default(cuid())
    name           String
    daysAllowed    Int
    carryForward   Boolean @default(false)
    isPaid         Boolean @default(true)

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    leaveRequests LeaveRequest[]
  }

  model LeaveRequest {
    id        String       @id @default(cuid())
    startDate DateTime     @db.Date
    endDate   DateTime     @db.Date
    reason    String
    status    LeaveStatus  @default(PENDING)
    createdAt DateTime     @default(now())
    updatedAt DateTime     @updatedAt

    employeeId String
    employee   Employee @relation(fields: [employeeId], references: [id])

    leaveTypeId String
    leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id])

    approvedById String?
  }

  enum LeaveStatus {
    PENDING
    APPROVED
    REJECTED
    CANCELLED
  }

    // ============== TASK ==============
  model Task {
    id          String       @id @default(cuid())
    title       String
    description String?
    status      TaskStatus   @default(TODO)
    priority    TaskPriority @default(MEDIUM)
    dueDate     DateTime?
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    assigneeId String?
    assignee   Employee? @relation("TaskAssignee", fields: [assigneeId], references: [id])

    creatorId String
    creator   Employee @relation("TaskCreator", fields: [creatorId], references: [id])
    projectId String?
    project   Project? @relation(fields: [projectId], references: [id])
  }

  enum TaskStatus {
    TODO
    IN_PROGRESS
    REVIEW
    DONE
  }

  enum TaskPriority {
    LOW
    MEDIUM
    HIGH
    URGENT
  }

  // ============== PROJECT ==============
  model Project {
    id          String        @id @default(cuid())
    name        String
    description String?
    status      ProjectStatus @default(ACTIVE)
    startDate   DateTime?
    endDate     DateTime?
    createdAt   DateTime      @default(now())
    updatedAt   DateTime      @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    ownerId String
    owner   Employee @relation("ProjectOwner", fields: [ownerId], references: [id])

    tasks Task[]
  }

  enum ProjectStatus {
    ACTIVE
    ON_HOLD
    COMPLETED
    CANCELLED
  }



  