 generator client {
    provider = "prisma-client-js"
  }

  datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
  }

  // Multi-tenant: Each organization is a separate company
  model Organization {
    id        String   @id @default(cuid())
    name      String
    slug      String   @unique
    logo      String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    users       User[]
    employees   Employee[]
    departments Department[]
    leaveTypes  LeaveType[]
    tasks       Task[]  
    projects Project[]
     jobs            Job[]
    candidates      Candidate[]
    applications    Application[]
    interviews      Interview[]
    candidateNotes  CandidateNote[]
  }

  // Authentication & access control
  model User {
    id             String   @id @default(cuid())
    email          String   @unique
    passwordHash   String
    role           Role     @default(EMPLOYEE)
    isActive       Boolean  @default(true)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    employee Employee?
  }

  enum Role {
    SUPER_ADMIN
    ADMIN
    HR_MANAGER
    MANAGER
    EMPLOYEE
  }

  model Department {
    id        String   @id @default(cuid())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    employees Employee[]
     jobs        Job[] 
  }

  model Employee {
    id            String    @id @default(cuid())
    employeeCode  String
    firstName     String
    lastName      String
    email         String
    phone         String?
    dateOfBirth   DateTime?
    gender        Gender?
    address       String?
    joiningDate   DateTime
    designation   String
    salary        Decimal   @db.Decimal(12, 2)
    status        EmployeeStatus @default(ACTIVE)
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    departmentId String
    department   Department @relation(fields: [departmentId], references: [id])

    userId String? @unique
    user   User?   @relation(fields: [userId], references: [id])

    managerId String?
    manager   Employee?  @relation("ManagerReports", fields: [managerId], references: [id])
    reports   Employee[] @relation("ManagerReports")

    attendances   Attendance[]
    leaveRequests LeaveRequest[]
    assignedTasks Task[] @relation("TaskAssignee")
    createdTasks  Task[] @relation("TaskCreator")
    ownedProjects Project[] @relation("ProjectOwner")

    interviews      Interview[]
    candidateNotes  CandidateNote[]
  }

  enum Gender {
    MALE
    FEMALE
    OTHER
  }

  enum EmployeeStatus {
    ACTIVE
    ON_NOTICE
    TERMINATED
    ON_LEAVE
  }

  model Attendance {
    id        String    @id @default(cuid())
    date      DateTime  @db.Date
    checkIn   DateTime?
    checkOut  DateTime?
    status    AttendanceStatus @default(PRESENT)
    notes     String?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    employeeId String
    employee   Employee @relation(fields: [employeeId], references: [id])

    @@unique([employeeId, date])
  }

  enum AttendanceStatus {
    PRESENT
    ABSENT
    HALF_DAY
    LATE
    ON_LEAVE
  }

  model LeaveType {
    id             String  @id @default(cuid())
    name           String
    daysAllowed    Int
    carryForward   Boolean @default(false)
    isPaid         Boolean @default(true)

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    leaveRequests LeaveRequest[]
  }

  model LeaveRequest {
    id        String       @id @default(cuid())
    startDate DateTime     @db.Date
    endDate   DateTime     @db.Date
    reason    String
    status    LeaveStatus  @default(PENDING)
    createdAt DateTime     @default(now())
    updatedAt DateTime     @updatedAt

    employeeId String
    employee   Employee @relation(fields: [employeeId], references: [id])

    leaveTypeId String
    leaveType   LeaveType @relation(fields: [leaveTypeId], references: [id])

    approvedById String?
  }

  enum LeaveStatus {
    PENDING
    APPROVED
    REJECTED
    CANCELLED
  }

    // ============== TASK ==============
  model Task {
    id          String       @id @default(cuid())
    title       String
    description String?
    status      TaskStatus   @default(TODO)
    priority    TaskPriority @default(MEDIUM)
    dueDate     DateTime?
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    assigneeId String?
    assignee   Employee? @relation("TaskAssignee", fields: [assigneeId], references: [id])

    creatorId String
    creator   Employee @relation("TaskCreator", fields: [creatorId], references: [id])
    projectId String?
    project   Project? @relation(fields: [projectId], references: [id])
  }

  enum TaskStatus {
    TODO
    IN_PROGRESS
    REVIEW
    DONE
  }

  enum TaskPriority {
    LOW
    MEDIUM
    HIGH
    URGENT
  }

  // ============== PROJECT ==============
  model Project {
    id          String        @id @default(cuid())
    name        String
    description String?
    status      ProjectStatus @default(ACTIVE)
    startDate   DateTime?
    endDate     DateTime?
    createdAt   DateTime      @default(now())
    updatedAt   DateTime      @updatedAt

    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id])

    ownerId String
    owner   Employee @relation("ProjectOwner", fields: [ownerId], references: [id])

    tasks Task[]
  }

  enum ProjectStatus {
    ACTIVE
    ON_HOLD
    COMPLETED
    CANCELLED
  }
 

  model Job {
      id               String          @id @default(uuid())
      title            String
      description      String?
      requirements     String?
      responsibilities String?
      location         String?
      jobType          JobType         @default(FULL_TIME)
      experienceLevel  ExperienceLevel @default(MID)
      salaryMin        Int?
      salaryMax        Int?
      status           JobStatus       @default(DRAFT)
      departmentId     String?
      department       Department?     @relation(fields: [departmentId], references: [id])
      organizationId   String
      organization     Organization    @relation(fields: [organizationId], references: [id])
      applications     Application[]
      interviews       Interview[]
      createdAt        DateTime        @default(now())
      updatedAt        DateTime        @updatedAt
      closedAt         DateTime?

      @@index([organizationId])
      @@index([status])
  }

  model Candidate {
      id             String          @id @default(uuid())
      firstName      String
      lastName       String
      email          String
      phone          String?
      resumeText     String?
      resumeUrl      String?
      linkedinUrl    String?
      portfolioUrl   String?
      currentCompany String?
      currentRole    String?
      experience     Int?
      skills         String[]
      source         CandidateSource @default(DIRECT)
      organizationId String
      organization   Organization    @relation(fields: [organizationId], references: [id])
      applications   Application[]
      interviews     Interview[]
      notes          CandidateNote[]
      createdAt      DateTime        @default(now())
      updatedAt      DateTime        @updatedAt

      @@unique([email, organizationId])
      @@index([organizationId])
  }

  model Application {
      id              String           @id @default(uuid())
      candidateId     String
      candidate       Candidate        @relation(fields: [candidateId], references: [id])
      jobId           String
      job             Job              @relation(fields: [jobId], references: [id])
      stage           ApplicationStage @default(APPLIED)
      rating          Int?
      organizationId  String
      organization    Organization     @relation(fields: [organizationId], references: [id])
      appliedAt       DateTime         @default(now())
      updatedAt       DateTime         @updatedAt
      hiredAt         DateTime?
      rejectedAt      DateTime?
      rejectionReason String?

      @@unique([candidateId, jobId])
      @@index([organizationId])
      @@index([jobId])
      @@index([stage])
  }

  model Interview {
      id             String          @id @default(uuid())
      candidateId    String
      candidate      Candidate       @relation(fields: [candidateId], references: [id])
      jobId          String
      job            Job             @relation(fields: [jobId], references: [id])
      interviewerId  String
      interviewer    Employee        @relation(fields: [interviewerId], references: [id])
      scheduledAt    DateTime
      duration       Int             @default(60)
      type           InterviewType   @default(VIDEO)
      location       String?
      status         InterviewStatus @default(SCHEDULED)
      feedback       String?
      rating         Int?
      organizationId String
      organization   Organization    @relation(fields: [organizationId], references: [id])
      createdAt      DateTime        @default(now())
      updatedAt      DateTime        @updatedAt

      @@index([organizationId])
      @@index([candidateId])
      @@index([scheduledAt])
  }

  model CandidateNote {
      id             String       @id @default(uuid())
      candidateId    String
      candidate      Candidate    @relation(fields: [candidateId], references: [id])
      authorId       String
      author         Employee     @relation(fields: [authorId], references: [id])
      content        String
      organizationId String
      organization   Organization @relation(fields: [organizationId], references: [id])
      createdAt      DateTime     @default(now())

      @@index([candidateId])
  }

  enum JobType {
      FULL_TIME
      PART_TIME
      CONTRACT
      INTERNSHIP
      REMOTE
  }

  enum ExperienceLevel {
      ENTRY
      MID
      SENIOR
      LEAD
      EXECUTIVE
  }

  enum JobStatus {
      DRAFT
      OPEN
      PAUSED
      CLOSED
      FILLED
  }

  enum CandidateSource {
      DIRECT
      LINKEDIN
      REFERRAL
      JOB_BOARD
      AGENCY
      CAREER_PAGE
      OTHER
  }

  enum ApplicationStage {
      APPLIED
      SCREENING
      INTERVIEW
      OFFER
      HIRED
      REJECTED
      WITHDRAWN
  }

  enum InterviewType {
      PHONE
      VIDEO
      IN_PERSON
      TECHNICAL
      HR
      FINAL
  }

  enum InterviewStatus {
      SCHEDULED
      COMPLETED
      CANCELLED
      NO_SHOW
      RESCHEDULED
  }
